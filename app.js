const busData = {
    "1":{
        "name": "1.새롬관",
        "times":["1회차: 8:30",
                "2회차: 9:30",		
                "3회차: 10:00",		
                "4회차: 10:30",	
                "5회차: 12:00",	
                "6회차: 13:00",	
                "7회차: 14:30",	
                "8회차: 16:00",	
                "9회차: 17:30",	
                "10회차: 18:00"]  ,
        "x":670,
        "y":550

    },

    "2":{
        "name": "2.미래 도서관",
        "times":["1회차: 8:32",	
                "2회차: 9:32",	
                "3회차: 10:02",	
                "4회차: 10:32",	
                "5회차: 12:02",	
                "6회차: 13:02",	
                "7회차: 14:32",	
                "8회차: 16:02",	
                "9회차: 17:32",
                "10회차: 18:02"	],
        "x":1200,
        "y":590
    },
    "3":{
        "name":"3.동생대 2호관",
        "times":["1회차: 8:34"	,
                "2회차: 9:34"	,
                "3회차: 10:04"	,
                "4회차: 10:34"	,
                "5회차: 12:04"	,
                "6회차: 13:04"	,
                "7회차: 14:34"	,
                "8회차: 16:04"	,
                "9회차: 17:34"	,
                "10회차: 18:04"	],
        "x":1270,
        "y":290
    },
    "4":{
        "name":"4.경영대 2호관",
        "times":["1회차: 8:36"	,
                "2회차: 9:36"	,
                "3회차: 10:06"	,
                "4회차: 10:36"	,
                "5회차: 12:06"	,
                "6회차: 13:06"	,
                "7회차: 14:36"	,
                "8회차: 16:06"	,
                "9회차: 17:36"	,
                "10회차: 18:06"	],
        "x":1000,
        "y":180
    },
    "5":{
        "name":"5.미래 광장",
        "times":["1회차: 8:38"	,
                "2회차: 9:38"	,
                "3회차: 10:08"	,
                "4회차: 10:38"	,
                "5회차: 12:08"	,
                "6회차: 13:08"	,
                "7회차: 14:38"	,
                "8회차: 16:08"	,
                "9회차: 17:38"	,
                "10회차: 18:08"	],
                "x":800,
                "y":100
    },
    "6":{
        "name":"6.백록관",
        "times":["1회차: 8:40"	,
                "2회차: 9:40"	,
                "3회차: 10:10"	,
                "4회차: 10:40"	,
                "5회차: 12:10"	,
                "6회차: 13:10"	,
                "7회차: 14:40"	,
                "8회차: 16:10"	,
                "9회차: 17:40"	,
                "10회차: 18:10"	],
                "x":640,
                "y":260
    },
    "7":{
        "name":"7.새롬관(회차)",
        "times":["1회차: 8:42"	,
                "2회차: 9:42"	,
                "3회차: 10:12"	,
                "4회차: 10:42"	,
                "5회차: 12:12"	,
                "6회차: 13:12"	,
                "7회차: 14:42"	,
                "8회차: 16:12"	,
                "9회차: 17:42"	,
                "10회차: 18:12"	],
                "x":770,
                "y":530
    },
    "8":{
        "name":"8.함인섭 광장",
        "times":["1회차: 8:44"	,
                "2회차: 9:44"	,
                "3회차: 10:14"	,
                "4회차: 10:44"	,
                "5회차: 12:14"	,
                "6회차: 13:14"	,
                "7회차: 14:44"	,
                "8회차: 16:14"	,
                "9회차: 17:44"	,
                "10회차: 18:14"	],
                "x":720,
                "y":300
    },
    "9":{
        "name":"9.미래 광장",
        "times":["1회차: 8:46"	,
                "2회차: 9:46"	,
                "3회차: 10:16"	,
                "4회차: 10:46"	,
                "5회차: 12:16"	,
                "6회차: 13:16"	,
                "7회차: 14:46"	,
                "8회차: 16:16"	,
                "9회차: 17:46"	,
                "10회차: 18:16"	],
                "x":780,
                "y":195
    },
    "10":{
        "name":"10.글로벌 경영관",
        "times":["1회차: 8:48"	,
                "2회차: 9:48"	,
                "3회차: 10:18"	,
                "4회차: 10:48"	,
                "5회차: 12:18"	,
                "6회차: 13:18"	,
                "7회차: 14:48"	,
                "8회차: 16:18"	,
                "9회차: 17:48",
                "10회차: 18:18"	],
                "x":1000,
                "y":265
    },
    "11":{
        "name":"11.의생대",
        "times":["1회차: 8:50"	,
                "2회차: 9:50"	,
                "3회차: 10:20"	,
                "4회차: 10:50"	,
                "5회차: 12:20"	,
                "6회차: 13:20"	,
                "7회차: 14:50"	,
                "8회차: 16:20"	,
                "9회차: 17:50"	,
                "10회차: 18:20"	],
                "x":1250,
                "y":400
    },
    "12":{
        "name":"12.미래 도서관",
        "times":["1회차: 8:52"	,
                "2회차: 9:52"	,
                "3회차: 10:22"	,
                "4회차: 10:52"	,
                "5회차: 12:22"	,
                "6회차: 13:22"	,
                "7회차: 14:52"	,
                "8회차: 16:22"	,
                "9회차: 17:52"	,
                "10회차: 18:22"	],
                "x":1150,
                "y":490
    },
    "13":{
        "name":"13.새롬관",
        "times":["1회차: 8:54"	,
                "2회차: 9:54"	,
                "3회차: 10:24"	,
                "4회차: 10:54"	,
                "5회차: 12:24"	,
                "6회차: 13:24"	,
                "7회차: 14:54"	,
                "8회차: 16:24"	,
                "9회차: 17:54"	,
                "10회차: 18:24"	],
                "x":770,
                "y":600
    }
}

// 이미지 로드 후 마커 생성
document.getElementById('campusMap').onload = function() {
    loadMarkers();
};

// 수정된 마커 생성 함수
function loadMarkers() {
    const markerContainer = document.getElementById('markerContainer');
    const mapImage = document.getElementById('campusMap');
    
    // 원본 이미지 크기
    const originalWidth = 736;
    const originalHeight = 703;
    
    function updateMarkers() {
        const rect = mapImage.getBoundingClientRect();
        const currentWidth = rect.width;
        const currentHeight = rect.height;
    
        // 모든 마커 위치 업데이트
        Array.from(markerContainer.querySelectorAll('.marker')).forEach(marker => {
            const stopId = marker.dataset.stopId;
            const stop = busData[stopId];
    
            // 원본 이미지에서의 비율 계산
            const ratioX = stop.x / originalWidth;
            const ratioY = stop.y / originalHeight;
    
            // 컨테이너 내부의 상대적 위치로 계산
            const newX = ratioX * currentWidth;
            const newY = ratioY * currentHeight;
    
            // 마커 위치 설정
            marker.style.left = `${newX}px`;
            marker.style.top = `${newY}px`;
        });
    }
    
    // 마커 생성
    Object.keys(busData).forEach(stopId => {
        const stop = busData[stopId];
        const marker = document.createElement('div');
        marker.className = 'marker';
        marker.dataset.stopId = stopId;
        marker.addEventListener('click', () => showArrivalTimes(stop));
        markerContainer.appendChild(marker);
    });
    
    // 초기 마커 위치 설정
    updateMarkers();
    
    // 창 크기 변경 시 마커 위치 업데이트
    window.addEventListener('resize', updateMarkers);
    
    // 이미지 크기 변경 감지
    const resizeObserver = new ResizeObserver(updateMarkers);
    resizeObserver.observe(mapImage);
}

// 모달 표시 함수
function showArrivalTimes(stop) {
    const modal = document.getElementById('timeModal');
    document.getElementById('stopName').textContent = stop.name;
    const list = document.getElementById('arrivalList');
    list.innerHTML = stop.times.map(time => `<li>${time}</li>`).join('');
    modal.style.display = 'block';
}

// 모달 닫기
document.querySelector('.close').addEventListener('click', () => {
    document.getElementById('timeModal').style.display = 'none';
});
